@page "/"
@inject NavigationManager Navigation
@inject IJSRuntime JSRuntime
@inject NavigationManager NavigationManager

<PageTitle>Schema Diagram Viewer</PageTitle>

<div class="min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 p-4 relative overflow-hidden">
    <div id="particles-js" class="absolute inset-0 z-0"></div>

    <div class="max-w-3xl w-full z-10 relative">
        <div class="max-w-2xl w-full space-y-8 animate-fade-in-up mx-auto">
            <div class="relative">
                <div class="absolute inset-0 flex items-center justify-center opacity-10 blur-3xl">
                    <div class="w-64 h-64 bg-blue-500 rounded-full mix-blend-multiply filter blur-xl animate-blob"></div>
                    <div class="w-64 h-64 bg-purple-500 rounded-full mix-blend-multiply filter blur-xl animate-blob animation-delay-2000"></div>
                    <div class="w-64 h-64 bg-pink-500 rounded-full mix-blend-multiply filter blur-xl animate-blob animation-delay-4000"></div>
                </div>
                
                <h1 class="relative text-5xl md:text-6xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600 dark:from-blue-400 dark:to-purple-400 mb-4 text-center">
                    Schema Diagram Viewer
                </h1>
            </div>
            
            <p class="text-xl text-gray-600 dark:text-gray-300 max-w-lg mx-auto leading-relaxed text-center">
                Visualize your SQL Server database schema with ease. 
                <span class="block mt-2 text-base opacity-80">Interactive diagrams, relationship mapping, and PDF export.</span>
            </p>

            <div class="flex flex-col sm:flex-row gap-4 justify-center mt-8">
                <button @onclick="NavigateToConnection" class="px-8 py-4 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-full shadow-lg hover:shadow-2xl hover:-translate-y-1 transition-all transform duration-200 flex items-center justify-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                    </svg>
                    Get Started
                </button>
                
                <button @onclick="OpenFileInput" class="px-8 py-4 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-800 dark:text-white font-bold rounded-full shadow-lg hover:shadow-2xl hover:-translate-y-1 transition-all transform duration-200 border border-gray-200 dark:border-gray-700 flex items-center justify-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                    </svg>
                    Load Diagram
                </button>
            </div>
        </div>
        
        <div class="mt-16 text-sm text-gray-400 dark:text-gray-500 text-center">
            &copy; @DateTime.Now.Year Schema Diagram Viewer
        </div>
    </div>
</div>

<InputFile id="diagram-file-input" style="display: none;" OnChange="HandleFileSelected" accept=".diagram" />

<style>
    @@keyframes blob {
        0% { transform: translate(0px, 0px) scale(1); }
        33% { transform: translate(30px, -50px) scale(1.1); }
        66% { transform: translate(-20px, 20px) scale(0.9); }
        100% { transform: translate(0px, 0px) scale(1); }
    }
    .animate-blob {
        animation: blob 7s infinite;
    }
    .animation-delay-2000 {
        animation-delay: 2s;
    }
    .animation-delay-4000 {
        animation-delay: 4s;
    }
    .animate-fade-in-up {
        animation: fadeInUp 0.8s ease-out;
    }
    @@keyframes fadeInUp {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
</style>

@code {
    private void NavigateToConnection()
    {
        Navigation.NavigateTo("/connection");
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            // Wait for splash screen to finish (2 seconds) before initializing particles
            await Task.Delay(2100);
            await JSRuntime.InvokeVoidAsync("initParticles");
        }
    }

    private async Task OpenFileInput()
    {
        await JSRuntime.InvokeVoidAsync("eval", "document.getElementById('diagram-file-input').click()");
    }

    private async Task HandleFileSelected(InputFileChangeEventArgs e)
    {
        var file = e.File;
        if (file != null)
        {
            using var stream = file.OpenReadStream();
            using var reader = new StreamReader(stream);
            var content = await reader.ReadToEndAsync();
            
            // Store the content in a service or pass it via query parameter/state
            // For now, let's just navigate and assume a service will pick it up
            NavigationManager.NavigateTo($"/diagram?loadContent={Uri.EscapeDataString(content)}");
        }
    }
}
